
import warnings
import pandas as pd

# å¯¼å…¥å›æµ‹é…ç½®å’Œæ¨¡å—
from core.model.backtest_config import load_config
from program.step1_æ•´ç†æ•°æ® import prepare_data
from program.step2_è®¡ç®—å› å­ import calculate_factors
from program.step3_é€‰è‚¡ import select_stocks
from program.step4_å®ç›˜æ¨¡æ‹Ÿ import simulate_performance

# ====================================================================================================
# ** é…ç½®ä¸åˆå§‹åŒ– **
# è®¾å®šè­¦å‘Šè¿‡æ»¤å’Œæ•°æ®å±•ç¤ºé€‰é¡¹ï¼Œä»¥ä¼˜åŒ–æ§åˆ¶å°è¾“å‡ºçš„é˜…è¯»ä½“éªŒ
# ====================================================================================================
warnings.filterwarnings("ignore")  # å¿½ç•¥è­¦å‘Šä¿¡æ¯ï¼Œä¿æŒè¾“å‡ºç®€æ´
pd.set_option("expand_frame_repr", False)  # è®¾ç½®æ•°æ®æ¡†æ˜¾ç¤ºä¸æ¢è¡Œ
pd.set_option("display.unicode.ambiguous_as_wide", True)
pd.set_option("display.unicode.east_asian_width", True)

if __name__ == "__main__":
    """
    ** å›æµ‹ä¸»ç¨‹åºæµç¨‹ **
    æœ¬è„šæœ¬æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
    0. åˆå§‹é…ç½®ä¸å‡†å¤‡
    1. æ•°æ®å‡†å¤‡ï¼šåŠ è½½å¹¶é¢„å¤„ç†å›æµ‹æ‰€éœ€æ•°æ®
    2. å› å­è®¡ç®—ï¼šè®¡ç®—ç”¨äºé€‰è‚¡çš„å› å­
    3. é€‰è‚¡ï¼šåŸºäºå› å­ç»“æœç­›é€‰ç›®æ ‡è‚¡ç¥¨
    4. å®ç›˜æ¨¡æ‹Ÿï¼šæ¨¡æ‹ŸæŠ•èµ„ç»„åˆçš„è¡¨ç°ï¼Œç”Ÿæˆèµ„é‡‘æ›²çº¿
    """

    # ====================================================================================================
    # 0. åˆå§‹å‡†å¤‡
    # ====================================================================================================
    # å¯åŠ¨å›æµ‹ç³»ç»Ÿ
    print("ğŸŒ€ å›æµ‹ç³»ç»Ÿå¯åŠ¨ä¸­ï¼Œè¯·ç¨å€™...")

    # åŠ è½½å›æµ‹é…ç½®
    conf = load_config()

    # ====================================================================================================
    # 1. æ•°æ®å‡†å¤‡
    # ====================================================================================================
    # è°ƒç”¨æ•°æ®å‡†å¤‡å‡½æ•°ï¼ŒåŠ è½½å¹¶é¢„å¤„ç†å›æµ‹æ‰€éœ€çš„æ•°æ®
    print("-" * 36, "å‡†å¤‡æ•°æ®", "-" * 36)
    prepare_data(conf)

    # ====================================================================================================
    # 2. å› å­è®¡ç®—
    # ====================================================================================================
    # æ ¹æ®é…ç½®æ–‡ä»¶è®¡ç®—ç­–ç•¥å› å­å’Œè¿‡æ»¤å› å­
    print("-" * 36, "å› å­è®¡ç®—", "-" * 36)
    calculate_factors(conf)

    # ====================================================================================================
    # 3. é€‰è‚¡
    # ====================================================================================================
    # æ ¹æ®è®¡ç®—å¾—åˆ°çš„å› å­è¿›è¡Œé€‰è‚¡
    print("-" * 36, "æ¡ä»¶é€‰è‚¡", "-" * 36)
    select_results = select_stocks(conf)

    # ====================================================================================================
    # 4. å®ç›˜æ¨¡æ‹Ÿ
    # ====================================================================================================
    # åŸºäºé€‰è‚¡ç»“æœï¼Œæ¨¡æ‹ŸæŠ•èµ„ç»„åˆè¡¨ç°å¹¶ç”Ÿæˆèµ„é‡‘æ›²çº¿
    print("-" * 36, "æ¨¡æ‹Ÿäº¤æ˜“", "-" * 36)
    simulate_performance(conf, select_results)
